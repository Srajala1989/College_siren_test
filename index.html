<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siren System | GPWH Admin</title>
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --bg: #f8fafc; --white: #ffffff; }
        body { background-color: var(--bg); font-family: 'Inter', sans-serif; margin: 0; color: #334155; }
        
        /* Navbar & Top Right Account */
        .navbar { 
            background: var(--white); padding: 0.75rem 1.5rem; display: flex; 
            justify-content: space-between; align-items: center; border-bottom: 1px solid #e2e8f0;
        }
        .nav-brand h1 { font-size: 0.9rem; margin: 0; text-transform: uppercase; color: var(--primary); }
        .profile-menu { position: relative; }
        .profile-btn { background: #f1f5f9; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; }
        .dropdown { display: none; position: absolute; right: 0; top: 110%; background: white; min-width: 150px; border-radius: 8px; box-shadow: 0 10px 15px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; z-index: 1000; }
        .profile-menu:hover .dropdown { display: block; }
        .dropdown button { width: 100%; text-align: left; padding: 10px; border: none; background: none; font-size: 13px; cursor: pointer; }

        /* Main Tabs Navigation */
        .tab-nav { display: flex; background: var(--white); border-bottom: 1px solid #e2e8f0; justify-content: space-around; }
        .tab-link { padding: 1rem; cursor: pointer; font-size: 13px; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; transition: 0.2s; }
        .tab-link.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* Content Sections */
        .main-content { max-width: 600px; margin: 1.5rem auto; padding: 0 1rem; }
        .card { background: var(--white); border-radius: 12px; padding: 1.5rem; border: 1px solid #e2e8f0; margin-bottom: 1.5rem; }
        .hidden { display: none !important; }

        /* Siren Button Styling */
        .siren-btn { width: 140px; height: 140px; border-radius: 50%; border: 8px solid #f1f5f9; background: #22c55e; color: white; font-weight: 800; cursor: pointer; margin: 1rem auto; display: block; transition: 0.3s; }
        .siren-btn.active { background: #ef4444; border-color: #fee2e2; box-shadow: 0 0 20px rgba(239,68,68,0.4); }

        /* Mode Selection Buttons */
        .mode-item { padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; cursor: pointer; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .mode-item.active { background: #eff6ff; border-color: var(--accent); color: var(--accent); }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; background: #cbd5e1; }
        .mode-item.active .status-dot { background: var(--accent); }

        /* Login Screen */
        .login-wrap { height: 80vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .login-box { background: white; padding: 2.5rem; border-radius: 16px; width: 100%; max-width: 340px; border: 1px solid #e2e8f0; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 6px; box-sizing: border-box; }
        .login-box button { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div id="loginPage" class="login-wrap">
    <div class="login-box">
        <h2>Admin Sign In</h2>
        <input type="email" id="email" placeholder="Email Address">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>
</div>

<div id="dashboardPage" class="hidden">
    <nav class="navbar">
        <div class="nav-brand"><h1>GPW Holenarasipura</h1></div>
        <div class="profile-menu">
            <button class="profile-btn">ADMIN â–¾</button>
            <div class="dropdown">
                <button onclick="auth.signOut()">Log Out</button>
            </div>
        </div>
    </nav>

    <div class="tab-nav">
        <div class="tab-link active" onclick="showTab('tab-manual')">Manual Siren</div>
        <div class="tab-link" onclick="showTab('tab-selection')">Mode Selection</div>
        <div class="tab-link" onclick="showTab('tab-settings')">Mode Settings</div>
    </div>

    <div class="main-content">
        <div id="tab-manual" class="tab-content">
            <div class="card" style="text-align:center">
                <p style="font-size:12px; font-weight:700; color:#94a3b8; text-transform:uppercase;">Quick Trigger</p>
                <button class="siren-btn" id="sirenBtn" onclick="toggleSiren()">TURN ON</button>
                <p id="sirenText" style="font-weight:700; color:#64748b">STATUS: READY</p>
            </div>
        </div>

        <div id="tab-selection" class="tab-content hidden">
            <div class="card">
                <p style="font-size:12px; font-weight:700; color:#94a3b8; text-transform:uppercase; margin-bottom:1rem">Active Operation Mode</p>
                <div class="mode-item" id="m_regular" onclick="setMode('regular')">Regular Classes <div class="status-dot"></div></div>
                <div class="mode-item" id="m_exam" onclick="setMode('exam')">Examination <div class="status-dot"></div></div>
                <div class="mode-item" id="m_special" onclick="setMode('special')">Special Event <div class="status-dot"></div></div>
            </div>
        </div>

        <div id="tab-settings" class="tab-content hidden">
            <div class="card">
                <h3>Mode Configurations</h3>
                <p style="font-size:14px; color:#64748b">Here you can define the siren duration and specific bell timings for each mode.</p>
                <hr style="border:0; border-top:1px solid #f1f5f9; margin:1.5rem 0">
                <div style="font-size:13px;">
                    <label>Default Ring Duration (Seconds)</label>
                    <input type="number" id="ringTime" value="5" style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px">
                </div>
                <button onclick="saveSettings()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:6px; margin-top:1.5rem; font-weight:bold; cursor:pointer">Save Settings</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpdIb1KL0z8ha5dEsKopwbSokE7jCxt68", 
        authDomain: "websirentest.firebaseapp.com",
        databaseURL: "https://websirentest-default-rtdb.firebaseio.com",
        projectId: "websirentest",
        storageBucket: "websirentest.appspot.com",
        appId: "1:223793739773:web:651543788764020a324911"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            initApp();
        } else {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
        }
    });

    function login() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
        document.getElementById(tabId).classList.remove('hidden');
        event.target.classList.add('active');
    }

    function initApp() {
        db.ref('siren_system/active_mode').on('value', snap => {
            const mode = snap.val() || 'regular';
            document.querySelectorAll('.mode-item').forEach(el => el.classList.remove('active'));
            document.getElementById('m_' + mode).classList.add('active');
        });

        db.ref('siren_system/manual_trigger/status').on('value', snap => {
            const isOn = snap.val();
            const btn = document.getElementById('sirenBtn');
            const txt = document.getElementById('sirenText');
            if(isOn) {
                btn.classList.add('active'); btn.innerText = "TURN OFF";
                txt.innerText = "STATUS: RINGING"; txt.style.color = "red";
            } else {
                btn.classList.remove('active'); btn.innerText = "TURN ON";
                txt.innerText = "STATUS: READY"; txt.style.color = "#64748b";
            }
        });
    }

    function setMode(m) { db.ref('siren_system/active_mode').set(m); }
    function toggleSiren() {
        const ref = db.ref('siren_system/manual_trigger/status');
        ref.once('value', snap => ref.set(!snap.val()));
    }
    function saveSettings() {
        const dur = document.getElementById('ringTime').value;
        db.ref('siren_system/settings').set({ duration: dur })
        .then(() => alert("Settings Updated!"));
    }
</script>
</body>
</html>
